<!DOCTYPE html>
<html>
        <head>
                <script type="text/javascript">
                GameBox = function()
                {
                    this.lastFrameTime = Date.now();
                    this.currentFrameTime = Date.now();
                    this.timeElapsed = 0;
                }

                ComplexNum = function(__re,__img)
                {
                    var __arg = function(re,img)
                    {
                        if ((re*img) >0) //Same Sign
                        {
                            if (re >0){
                                //1st Quadrant
                                return Math.atan(img/re);
                            } else {
                                //3rd Quadrant
                                return Math.atan(img/re) + Math.PI;
                            }
                        }
                        else //Different Sign
                        { 
                            if (re <0){
                                //2nd Quadrant
                                return Math.atan(img/re) + Math.PI;
                            } else {
                                //4th Quadrant
                                return Math.atan(img/re) + 2 * Math.PI;
                            }
                        }
                    }

                     this.real = __re * 50;
                     this.imaginary = __img * -50;
                     this.module = Math.sqrt(  Math.pow(__re,2) + Math.pow(__img,2)  );
                     this.argument = __arg(__re,__img);
                     this.showX  = canvasCenter.x + __re * 200 ;
                     this.showY  = canvasCenter.y + __img * -200 ;
                     
                }
                ComplexNum.prototype.fromPolar = function(z,fi)
                     {

                        return new ComplexNum(z * Math.cos(fi), z * Math.sin(fi));
                     }

                GameBox.prototype.gameLoop = function()
                {
                   window.requestAnimationFrame(this.gameLoop.bind(this));
                   this.lastFrameTime = this.currentFrameTime;
                   this.currentFrameTime = Date.now();
                   this.timeElapsed +=  this.currentFrameTime - this.lastFrameTime ;
             
                  this.update(this.timeElapsed / 100); 
                    this.render(this.timeElapsed / 100);
                  this.timeElapsed = 0;
                

                }

                let MaxX = 400;
                let MinX = 100;
                let MaxY = 400;
                let MinY = 100;
                let canvasHeight = 600;
                let canvasWidth = 600;

                let canvasCenter = { x: canvasWidth / 2 ,y: canvasHeight / 2}


                var complex = new ComplexNum(1, 1);

                let rootColor = "#ff0000";
                let circleColor =  "#b0b0b0"
                let poligonColor = "#00ff00"
                let complexColor = "#707070"
                
                var ctx = {};
                var calcRoots = true;
                var roots = [];

                GameBox.prototype.update = function(timeElapsed)
                {

                    var real = document.getElementById('Real').value;
                    var imag = document.getElementById('Imaginary').value;

                    complex = new ComplexNum(real, imag);
                    //
                    this.getRoots(complex);
                       
                        
                }

                 GameBox.prototype.getRoots = function(complex)
                {
                    var n = document.getElementById('Roots').value;
                    if (n<2)
                    {
                        return;
                    }

                    roots = [];
                    var z = Math.pow(complex.module,1/n);

                    var deltaFi = 2 * Math.PI / n;

                    var fi0 = complex.argument / n

                    for (var i = 0; i <= n - 1; i++) {

                        roots[i] = new ComplexNum().fromPolar(z,fi0 + i * deltaFi);
                    }
                    
                     
                        
                }


              /*  GameBox.prototype.dot = function dot( a, b )
                        {
                            return ( a.x * b.x ) + ( a.y * b.y );
                        }

                GameBox.prototype.reflect = function(vector, normal){
                        
                            // using the formula [R = V - (2 * V.N) * N] or [V -= 2 * N * (N.V)]
                            var vn2 = 2.0 * this.dot( vector, normal );
                            return { 
                                x: vector.x - ( normal.x * vn2 ),
                                y: vector.y - ( normal.y * vn2 )
                        }
                             

                }

                GameBox.prototype.getNextPos = function(timeElapsed)
                {
                       
                        return { 
                                x: pos.x + direction.x * timeElapsed * speed * 10,
                                y: pos.y + direction.y * timeElapsed * speed * 10,
                        }

                }
                */
                var acum = 0;
                GameBox.prototype.render= function(timeElapsed){
                        
                        ctx.clearRect(0, 0, 600 /*canvas.width*/, 600 /*canvas.height*/);
                       
                        // Y Axis
                        ctx.beginPath();
                        ctx.moveTo(canvasCenter.x , 0);
                        ctx.lineTo(canvasCenter.x, canvasHeight);
                        ctx.stroke();

                        //X Axis
                        ctx.moveTo(0, canvasCenter.y );
                        ctx.lineTo(canvasWidth, canvasCenter.y );
                        ctx.stroke();

                        //Roots
                        if (document.getElementById('Poligon').checked)
                        {
                            var ptoAnterior = roots[0];
                            var primerPunto = roots[0];

                            roots.forEach(function(complexRoot) {

                                ctx.moveTo(complexRoot.showX , complexRoot.showY);
                                ctx.lineTo(ptoAnterior.showX, ptoAnterior.showY);
                                ctx.stroke();
                                ptoAnterior = complexRoot;
                               
                            });

                            ctx.moveTo(primerPunto.showX , primerPunto.showY);
                            ctx.lineTo(ptoAnterior.showX, ptoAnterior.showY);
                            ctx.stroke();
                        }
                            
                        roots.forEach(function(complexRoot) {
                            ctx.beginPath();
                            ctx.arc(complexRoot.showX, complexRoot.showY, 4 , 0, 2 * Math.PI, true);
                            ctx.fill();
                         });


                        // Complex
                        ctx.fillStyle = rootColor;

                        acum += timeElapsed;
                        if (acum >10000) acum = 0;

                        ctx.beginPath();
                        ctx.arc(complex.showX , complex.showY , 4 , 0, 2 * Math.PI, true);
                        ctx.fill();
                        
                        //Borders
                        ctx.strokeStyle = '#000000';
                        ctx.rect(0,0,600,600);
                        ctx.stroke();
                }


                function Init(){
                        ctx = document.getElementById('a').getContext("2d");
                        var a = new GameBox();
                        a.gameLoop();
                }
                </script>
        </head>
<body onload="Init()">
        <canvas id="a" width="600" height="600"></canvas>       
        <p>Zoom: x200</p>
        <label>Real:</label>
        <input type="text" name="Real" Id="Real" value="1">
        <label>Imaginary:</label>
        <input type="text" name="Imaginary" Id="Imaginary" value="1">

        <label>Roots:</label>
        <input type="text" name="Roots" Id="Roots" value="2">
      
      <label>Poligon:</label>
        <input type="checkbox" name="Poligon" Id="Poligon" checked="checked">
        



</body>
</html>
